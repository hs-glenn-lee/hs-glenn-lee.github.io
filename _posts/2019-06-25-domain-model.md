---
layout: post
title:  "도메인 모델 (PoEAA에서)"
author: "이희수"
---

# 도메인 모델

> An object model of the domain that incorporates both behavior and data.

동작과 데이터를 모두 포함하는 도메인의 객체 모델

![도메인 모델 스케치]({{site.url}}/assets/post_images/domainModelSketch.gif)

비즈니스 논리는 경우에 따라 아주 복잡할 수 있다. 규칙과 논리는 매우 다양한 사례와 동작의 변형을 나타내며, 객체는 이러한 복잡성을 처리하기 위해 고안됐다. 도메인 모델은 각 객체가 하나의 기업과 같이 복잡하거나 주문서의 내용 한 줄과 같이 간단한, 의미있는 하나의 대상을 나타내는 상호 연결된 객체의 연결망으로 이뤄진다.

- 도메인 모델을 구현하는 과정은 비즈니스 영역을 모델링하는 객체로 구성된 계층을 구성하는 과정이다.

![계층화된 시스템]({{site.url}}/assets/post_images/domainModelSketch.gif)

- 객체지향 도메인 모델과 데이터베이스  모델은 비슷해 보이지만 차이점도 많다. 도메인 모델은 데이터와 프로세스가 혼합된 구조이고, 다중 값 속성과 복잡한 연결망을 가지며, 상속을 사용한다.

- 주로 두가지 형식의 도메인 모델
<br>단순(?) 도메인 모델 : 객체가 각 데이터베이스 테이블과 일치.
<br>리치 도메인 모델 : 상속, 전략, 디자인 패턴, 복잡한 객체 연결망을 포함한다. 복잡한 논리를 나타내는 데 적합하지만 데이터베이스에 매핑하기는 더 어렵다. *단순 도메인 모델에는 활성 레코드(active record)를 사용할 수 있지만 리치 도메인 모델에는 데이터 매퍼가 필요하다.*

- 비즈니스의 동작은 자주 변경해야 하므로 이 계층을 손쉽게 수정, 구축, 테스트할 수 있게 만드는 일이 아주 중요하다. 이를 위해서는 도메인 모델과 시스템의 다른 계층 간의 결합을 최소화해야한다.

- 도메인 모델의 단순한 예는 파일을 몽땅 읽어 메모리에 저장하는 단일 사용자 어플리케이션이다. (규모가 커지면 메모리가 부족하므로 부적합하다.)

- *도메인 논리와 관련해서 흔히 하는 고민은 도메인 객체가 과하게 비대해지는 것이다.* 예를 들어, 주문을 처리하는 화면을 만들 때 일부 주문의 동작은 특정 주문에만 필요할 수 있다. 이러한 동작을 모든 주문에 추가하면 주문 클래스가 특정 사례에 한 번만 사용되는 동작으로 가득 차서 지나치게 커질 수 있다.
<br>이러한 문제를 예방하기 위해 사람들은 어떤 동작이 일반적인지 여부를 먼저 고려한 후, 일반적인 동작은 주문 클래스에 넣고, 특정한 동작은 일종의 사례별로 클래스(트랜잭션 스크립트나 프레젠테이션 자체에 해당하는)에 넣는 방법을 생각했다.
<br> -> *트랜잭션 스크립트=쿼리, 프레젠테이션=controller ?*
<br>**그런데 이처럼 특정 사례의 동작을 분리하면 중복이 발생할 우려가 있다.** 주문에서 분리된 동작은 찾기 어렵기 때문에 비슷한 동작이 필요할 때 이를 찾아보지 않고 간단하게 중복하는 경우가 많다. **중복은 곧바로 복잡성과 일관성 문제를 일으키지만 객체가 비대해지는 문제는 우려하는 것만큼 자주 발생하지 않는다. 그리고 비대한 객체는 눈에 쉽게 띄며 수정하기도 쉽다. 따라서 특정 사례의 동작을 분리하지 말고 가장 적당한 객체에 모두 넣는 것이 좋다. 그리고 객체가 비대해지고 이것이 문제가 되면 해결하면 된다.**

- (J2EE에 관한 이야기) **필자가 내린 결론은 도메인 논리가 그리 복잡하지 않으면 엔티티 빈을 도메인 모델로 사용해도 좋다는 것이다. 즉, 각 엔티티 빈이 데이터베이스 테이블 하나와 매핑되는 간단한 관계를 바탕으로 도메인 모델을 구축할 수 있다.** 반면 상속, 전략 그밖의 다른 정교한 패턴 등이 포함된 복잡한 도메인 논리를 구축하려면 상업용 툴이나 직접 제작한 계층을 활용해 POJO 도메인 모델과 데이터 매퍼를 만드는 것이 좋다.

## 사용 시점

도메인 모델이 방대한 주제이기 때문에 사용하는 방법을 설명하기 어려웠다면, 도메인 모델을 사용하는 시기는 조언의 모호함과 단순함 때문에 설명하기 어렵다. 가장 중요한 것은 시스템이 수행하는 동작의 복잡도다. 유효성 검사, 계산, 파생 등이 포함된 복잡하고 끊임없이 변하는 비즈니스 규칙을 구현해야 한다면 객체 모델을 사용해 비즈니스 규칙을 처리하는 것이 현명하다. 반면 간단한 null 검사, 두어 가지 합계 계산 등이 전부라면 트랜잭션 스크립트가 더 나은 선택이다.
<br>개발 팀이 도메인 객체를 이용하는데 얼마나 익숙한 지에 대해서도 고려해 봐야한다. **도메인 모델을 설계하고 사용하는 방법을 배우는 것은 상당히 쉽지 않은 과정**이며 "패러다임 전환"이라는 주제의 수많은 글이 쓰여진 배경이 됐다. 도메인 모델을 익숙하게 사용하려면 적지 않은 연습과 교육이 필요하지만 일단 익숙해진 후에는 정말 간단한 문제가 아니고서는 트랜잭션 스크립트로 돌아가고 싶지 않을 것이다.

- 도메인 모델에 더 고유한 API를 적용하려면 서비스 계층을 사용하는 것을 고려할 수 있다.

### 참고 자료
객체지향 설계에 대한 안내서를 찾고있다면 "Larman"을 가장 먼저 추천한다.
<br>도메인 모델에 대한 예제를 찾고 있다면 "Fowler AP"를 추천한다.
<br>"Hay"에는 관계형 환경과 관련된 좋은 예제가 많다.
<br>"Martin-Odell"은 객체에 대한 개념적 사고방식을 이해하는 데 좋다.
<br>객체지향 시스템에서 사용할 패턴을 이해하려면 GoF
<br>에릭 에반스는 도메인 모델 구축에 대한 책 "Evans"를 집필하고 있다. (DDD)

.. 정확한 책 제목은 나중에 찾아보자 ..
